from telegram import Update
from telegram.ext import ContextTypes
from db import create_or_get_user
from handlers.utils import build_main_menu


async def start_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start ‚Äî —Å—Ç–≤–æ—Ä—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ –ø–æ–∫–∞–∑—É—î –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é."""
    user_id = update.effective_user.id
    # –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∞–±–æ –æ—Ç—Ä–∏–º–∞–Ω–∏–π –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –º–µ–Ω—é
    user = create_or_get_user(user_id) 

    greeting_text = (
        "üëã <b>–ü—Ä–∏–≤—ñ—Ç! –í—ñ—Ç–∞—é —É ¬´–ú–µ—Ö–ú–∞—Ç–∏–∫—É¬ª!</b> ü§ñ\n"
        "–¢–≤—ñ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ <b>–ù–ú–¢ –∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏</b> üìê\n\n"
        "üìå <b>–Ø–∫ —Ç—É—Ç –≤—Å–µ –≤–ª–∞—à—Ç–æ–≤–∞–Ω–æ:</b>\n"
        "   üìö –û–±–∏—Ä–∞–π —Ç–µ–º—É —Ç–∞ —Ä—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ.\n"
        "   üí° –†–æ–∑–≤'—è–∑—É–π –∑–∞–¥–∞—á—ñ —Ç–∞ –æ—Ç—Ä–∏–º—É–π –ø–æ—è—Å–Ω–µ–Ω–Ω—è.\n"
        "   üèÜ –ù–∞–∫–æ–ø–∏—á—É–π –±–∞–ª–∏ —Ç–∞ –∑–º–∞–≥–∞–π—Å—è —É —Ä–µ–π—Ç–∏–Ω–≥—É!\n\n"

        "üí∞ <b>–°–∏—Å—Ç–µ–º–∞ –±–∞–ª—ñ–≤ (V2):</b>\n"
        "   ‚úÖ <code>+1 –±–∞–ª</code> - –¢–µ—Å—Ç (1 –≤—ñ–¥–ø–æ–≤—ñ–¥—å)\n"
        "   üìä <code>+1 –±–∞–ª</code> - –ó–∞ –∫–æ–∂–Ω—É –≤—ñ—Ä–Ω—É –ø–∞—Ä—É —É '–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ' (–º–∞–∫—Å. 3)\n"
        "   ‚úèÔ∏è <code>+2 –±–∞–ª–∏</code> - –í—ñ–¥–∫—Ä–∏—Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å\n"
        "   ü§Ø <code>+10 –±–∞–ª—ñ–≤</code> - BOSS/¬´–≥—Ä–æ–±–∏–∫¬ª\n"
        "   üëÄ <i>(–õ–∞–π—Ç–æ–≤—ñ –∑–∞–¥–∞—á—ñ –±–∞–ª—ñ–≤ –Ω–µ –¥–∞—é—Ç—å)</i>\n\n"

        "üéÅ <b>–ë–æ–Ω—É—Å–∏ —Ç–∞ –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è:</b>\n"
        "   üî• –ü—ñ–¥—Ç—Ä–∏–º—É–π —Å–µ—Ä—ñ—é –¥–Ω—ñ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ!\n"
        "   üéØ –†–æ–±–∏ —Å–µ—Ä—ñ—ó –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —É —Ç–µ–º–∞—Ö!\n"
        "   üèÖ –í—ñ–¥–∫—Ä–∏–≤–∞–π –∫—Ä—É—Ç—ñ –±–µ–π–¥–∂—ñ –∑–∞ —Å–≤–æ—ó —É—Å–ø—ñ—Ö–∏!\n\n"

        "üëá <b>–ü–æ—á–∏–Ω–∞–π –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é:</b>"
    )

    await update.message.reply_text(
        greeting_text,
        parse_mode="HTML",
        reply_markup=build_main_menu(user_id) # –ü–µ—Ä–µ–¥–∞—î–º–æ user_id –¥–ª—è –º–æ–∂–ª–∏–≤–æ—ó –∫–Ω–æ–ø–∫–∏ –∞–¥–º—ñ–Ω–∞
    )